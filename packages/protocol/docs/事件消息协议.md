## 事件消息协议

事件消息的基本格式：
{
    "type"     : 6,
    "sid"      : 0,
    "from"     : <String:分机sn>,
    "to"       : "",
    "timestamp": <Long:timestamp>,
    "flags"    : {},
    "token"    : <String:token>,
    "tid"      : <Long:tid>,
    "payload"  : {
        "code"    : <事件编码>,
        "source"  : <子设备sn，若非子设备触发则同from>,
        "level"   : <事件等级1~5>,
        "location": {
            "map": <地图>,
            "label": <String:地理位置文字描述>,
            "x" : <Float:经度>,
            "y" : <Float:纬度>,
            "z" : <Float:高度>
        },
        // 其它依 code 不同而不同的字段（事件参数）
        "progress": 10,
        "result"  : 1,
        // 其它附加字段，比如：
        "from"    : <String:本机号码>,  // 通讯事务才有
        "to"      : <String:被叫号码>,  // 通讯事务才有
    }
}
编码说明
编码范围	说明
xxx	平台事件
1xxx	设备事件
2xxx	通讯事件
3xxx	资源事件
4xxx	I/O 事件
5xxx	会议事件
6xxx	用户事件
7xxx	（保留）
8xxxyyyy	应用业务事件
（前四位为应用业务消息编码空间，见设备类型定义）
9xxxyyyy	设备特有事件
（前四位为设备专用消息编码空间，见应用名称定义）
已定义的通用设备事件有：
设备事件
注：以下负载只列出除了 code 和 message 以及可选的进度信息之外的字段
编码	级别	说明	负载
1000	3	设备准备就绪	
1001	3	设备状态变更	{ "status": <变更状态键值对> }
1002	3	设备属性变更	{ "status": <变更属性键值对> }
1003	3	设备事务进度	{ "progress": <进度值>, "result": <结果值> }
1004	3	设备关机前	
1005	3	设备告警已取消	见说明
1006	3	设备告警已处理	见说明
1007	3	设备性能报告	见说明
通话事件
注：以下负载只列出除了 code 和 message 以及可选的进度信息之外的字段
编码	级别	说明	负载
2000	3	通话：初始化完成	
2001	3	通话：摘机	
2002	3	通话：呼出	{ "from": <主叫号码>, "to": <被叫号码> }
2003	3	通话：取消呼出	{ "from": <主叫号码>, "to": <被叫号码> }
2004	3	通话：呼出被接通	{ "from": <主叫号码>, "to": <被叫号码> }
2005	3	通话：呼出结束	{ "from": <主叫号码>, "to": <被叫号码> }
2100	3	通话：呼入	{ "from": <主叫号码>, "to": <被叫号码> }
2101	3	通话：拒接呼入	{ "from": <主叫号码>, "to": <被叫号码> }
2102	3	通话：接受呼入	{ "from": <主叫号码>, "to": <被叫号码> }
2103	3	通话：结束呼入	{ "from": <主叫号码>, "to": <被叫号码> }
2104	3	通话：转移呼叫	{ "from": <主叫号码>, "to": <被叫号码> }
2105	3	通话：呼叫等待	{ "from": <主叫号码>, "to": <被叫号码> }
2200	3	通话：连接媒体流	{ "from": <主叫号码>, "to": <被叫号码> }
2201	3	通话：断开媒体流	{ "from": <主叫号码>, "to": <被叫号码> }
2300	3	通话：暂停呼叫	{ "from": <主叫号码>, "to": <被叫号码> }
2301	3	通话：恢复呼叫	{ "from": <主叫号码>, "to": <被叫号码> }
			
资源事件
注：以下负载只列出除了 code 和 message 以及可选的进度信息之外的字段
编码	级别	说明	负载
3001	3	创建资源	{ "url": <资源url>, "resType": <资源类型>, "resId": <资源id>, "params": <参数>, "fields": <变更的字段>, "modifiedData": <变更的数据> }
3002	3	更新资源	{ "url": <资源url>, "resType": <资源类型>, "resId": <资源id>, "params": <参数>, "fields": <变更的字段>, "modifiedData": <变更的数据> }
3003	3	删除资源	{ "url": <资源url>, "resType": <资源类型>, "resId": <资源id>, "params": <参数>, "fields": <变更的字段>, "modifiedData": <变更的数据> }
3004	3	压入资源	{ "url": <资源url>, "resType": <资源类型>, "resId": <资源id>, "params": <参数>, "fields": <变更的字段>, "modifiedData": <变更的数据> }
3005	3	弹出资源	{ "url": <资源url>, "resType": <资源类型>, "resId": <资源id>, "params": <参数>, "fields": <变更的字段>, "modifiedData": <变更的数据> }
3006	3	变更资源	{ "url": <资源url>, "resType": <资源类型>, "resId": <资源id>, "params": <参数>, "fields": <变更的字段>, "modifiedData": <变更的数据> }
3007	3	单调资源	{ "url": <资源url>, "resType": <资源类型>, "resId": <资源id>, "params": <参数>, "fields": <变更的字段>, "modifiedData": <变更的数据> }
3008	3	对调资源	{ "url": <资源url>, "resType": <资源类型>, "resId": <资源id>, "params": <参数>, "fields": <变更的字段>, "modifiedData": <变更的数据> }
			

I/O 事件
注：以下负载只列出除了 code 和 message 以及可选的进度信息之外的字段
编码	级别	说明	负载
4000	×	人工按键	
4001	×	短路输入	
4002	×	433无线接入	
4003	×	蓝牙无线接入	
4004	×	UI界面按钮	
			
会议事件
注：以下负载只列出除了 code 和 message 以及可选的进度信息之外的字段
编码	级别	说明	负载
5×××	×	××××	
			
用户事件
注：以下负载只列出除了 code 和 message 以及可选的进度信息之外的字段
编码	级别	说明	负载
6000	3	用户登录	
6001	3	用户登出	
			
（保留事件）
注：以下负载只列出除了 code 和 message 以及可选的进度信息之外的字段
编码	级别	说明	负载
7×××	×	××××	
			
应用业务事件
注：以下负载只列出除了 code 和 message 以及可选的进度信息之外的字段
编码	级别	说明	负载
8×××	×	××××	
			
设备特有事件
注：以下负载只列出除了 code 和 message 以及可选的进度信息之外的字段
编码	级别	说明	负载
9×××	×	××××	
			
设备事件（1xxx）
设备准备就绪（1000）
当设备启动完毕并完成初始化后，触发此事件：
● 事件编码：1000
● 事件消息：（基本消息）
设备状态变更（1001）
当设备状态值发生变更后，触发此事件。
● 事件编码：1001
● 事件消息：
{
    // 头部参见基本消息
    "payload": {
        "code": 1001,
        // 发生变化的状态
        "status": {
            "状态名称": 状态当前值,
            // ...更多状态
        },
        // 如果是事务，还应附带：
        "progress": 进度值,
        "result"  : 事务处理结果
    }
}
注：
 
● 如果一个状态的值是结构体，则 value 或 oldValue 为结构体；数组、字符串等亦然
● 如果一个状态的值是结构体，则 value 或 oldValue 推荐只包含变更的字段（简化处理也可以包含所有字段）
● oldValue 为可选
 
设备属性变更（1002）
当设备属性值发生变更后，触发此事件。
● 事件编码：1002
● 事件消息：
{
    // 头部参见基本消息
    "payload": {
        "code": 1002,
        // 发生变化的属性
        "attrs": {
            "属性名称": { "value": 属性当前值, "oldvalue": 属性旧值 },
            // ...更多属性
        },
        // 如果是事务，还应附带：
        "progress": 进度值,
        "result"  : 事务处理结果
    }
}
注：
 如果一个属性的值是结构体，则 value 或 oldValue 为结构体；数组、字符串等亦然
● 如果一个属性的值是结构体，则 value 或 oldValue 推荐只包含变更的字段（简化处理也可以包含所有字段）
● oldValue 为可选
设备事务进度（1003）
当设备需要报告事务进度时，触发此事件。
● 事件编码：1003
● 事件消息：
{
    // 头部参见基本消息
    "payload": {
        "code": 1003,
        // 其它负载参见基本消息
        "progress": 进度值,
        "result"  : 事务处理结果
    }
}
payload.result 结果值定义：
● 1：事务正处理
● 2：事务被挂起
● 3：事务被恢复
● 10：事务已完成
● 11：未服务（？）
● 12：事务被忽略
● 13：事务被转移
● 14：事务被拒绝
● 15：事务超时结束
● 19：事务出错结束
设备关机前（1004）
设备关机或重启前，触发此事件。
● 事件编码：1004
● 事件消息：（参见基本消息）
设备告警已取消（1005）
设备告警取消后，触发此事件。
注：此事件消息 tid 与被取消的告警消息 tid 应一致。
● 事件编码：1005
● 事件消息：
{
    // 头部参见基本消息
    "payload": {
        "code": 1005,
        "alarmCode": 相应的告警编码,
        "alarmId": 相应的告警id,
        // 注：
        // alarmId 的计算流程：
        // 1. 告警的发出设备sn 拼接 相应告警消息timestamp
        // 2. 计算这个拼接后的字符串的 16 位 md5 值
        // 3. 这个 md5 值对应的 hex 字符串（全小写）即为告警 id
        // 例：
        // 设备（sn=123abc456def）发出告警（code=8000），
        // 其中，告警消息体中 timestamp = 1589508943262
        // 一段时间后，设备（sn=123）取消该告警时，（以下伪代码）
        // 则对应的 alarmId = md5("123abc456def1589508943262", 16).toHex().toLowerCase()

        "alarmResult": 告警取消结果，取值从事务处理结果（仅取值，告警取消不等同于事务结束）
        // 注：告警取消结果有：11、15、19，分别对应“未服务（取消）”、“出错”、“超时”

        // 设备有登录用户时，还应携带取消该告警的用户索引信息
        // 由此索引信息，订阅方可获取用户完整信息
        // 采用 http 请求的方式，url 为：
        // http://应用服务器地址:端口/apps/Domain值/api/users/userId值
        // 所获得的成功响应内容为：{ status: "success", payload: {用户完整信息} } （详见 API 文档）
        "userId": 用户id

        // （可选）取消告警时，可附带的备注
        "remarks": "",

        // 必要时，携带事务及处理结果
        "progress": 进度值,
        "result"  : 事务处理结果
    }
}
设备告警已处理（1006）
设备告警被处理后，触发此事件。
● 事件编码：1006
● 事件消息：
{
    // 头部参见基本消息
    "payload": {
        "code": 1006,
        "alarmCode": 相应的告警编码,
        "alarmId": 相应的告警id,
        // 注：
        // alarmId 的计算流程：
        // 1. 告警的发出设备sn 拼接 相应告警消息timestamp
        // 2. 计算这个拼接后的字符串的 16 位 md5 值
        // 3. 这个 md5 值对应的 hex 字符串（全小写）即为告警 id
        // 例：
        // 设备（sn=123abc456def）发出告警（code=8000），
        // 其中，告警消息体中 timestamp = 1589508943262
        // 一段时间后，设备（sn=123）取消该告警时，（以下伪代码）
        // 则对应的 alarmId = md5("123abc456def1589508943262", 16).toHex().toLowerCase()

        "alarmResult": 告警处理结果，取值从事务处理结果（仅取值，告警取消不等同于事务结束）
        // 注：告警处理结果有：10、12、14、16，分别对应“完成”、“忽略”、“拒绝”、“误报”

        // 设备有登录用户时，还应携带取消该告警的用户索引信息
        // 由此索引信息，订阅方可获取用户完整信息
        // 采用 http 请求的方式，url 为：
        // http://应用服务器地址:端口/apps/Domain值/api/users/userId值
        // 所获得的成功响应内容为：{ status: "success", payload: {用户完整信息} } （详见 API 文档）
        "userId": 用户id

        // （可选）处理告警时，可附带的备注
        "remarks": "",

        // 必要时，携带事务及处理结果
        "progress": 进度值,
        "result"  : 事务处理结果
    }
}
设备性能报告（1007）
设备需要进行性能报告时，如被执行开始设备性能报告动作时，触发此事件。
● 事件编码：1007
● 事件消息：
{
    // 头部参见基本消息
    "payload": {
        "code": 1007,
        // 设备性能指标
        // 注：
        //   鉴于存在多核CPU、多个内存条、多个存储分区、多个交换分区、多块电池的情况
        //   因此状况数据都采用数组的形式
        //   对于单核CPU或单个内存的设备，则只需报告该单核CPU或单个内存等的性能
        
        // CPU性能（包括负载、温度等）
        "cpu": [
            // 如果是单核CPU，则只报告一个CPU的性能
            {
                "temperature": <温度（℃）>,
                "load": <负载或使用率（百分比）>，
                // ...其它待扩展指标
            },
            // 多核CPU则追加到数组
        ],
        // 内存使用状况
        "mem": [
            {
                "total": <总量（byte）>,
                "used": <使用量（byte）>,
                "free": <空闲量（byte）>，
                // ...其它待扩展指标
            },
        ],
        // 存储分区使用状况
        "sd": [  // (sd = storage device)
            {
                "name": '<分区名称>',  // 如 sda1
                "total": <总量（byte）>,
                "used": <使用量（byte）>,
                "free": <空闲量（byte）>，
                // ...其它待扩展指标
            },
        ],
        // 交换分区使用状况
        "swap": [
            {
                "name": '<分区名称>',  // 如 sda1
                "total": <总量（byte）>,
                "used": <使用量（byte）>,
                "free": <空闲量（byte）>，
                // ...其它待扩展指标
            },
        ],
        // 电池电量
        "battery": [
            {
                "total": <总量（byte）>,
                "used": <使用量（byte）>,
                "free": <空闲量（byte）>，
                // ...其它待扩展指标
            },
        ],
        // ...其它待扩展指标
    }
}
通话事件（2xxx）
通话事件是指与通话有关的各类事件。
一个通话从呼叫开始到结束（包括正常结束、拒接、出错等），这些事件串联起来，形成一个通话事务。
为了对通话事务进行跟踪和处理，通话事件的消息内容同时还应符合 VIMP 既定的设备事务处理协议。
其中：
● 通话事务的事务 ID 应参考 设备事务处理 - 事务 ID
● 通话事务的流程及各环节进度值应在具体业务中定义。如医疗相关事务
关于通话事务进度值，也可参考以下通用的通话事务进度定义：
（主叫方、被叫方、各联动方应共同协商约定采用同一套进度值定义，否则可能导致进度值混乱）
主叫方流程	被叫方流程	取消呼出流程	拒接呼入流程	呼入时转移流程	通话时转移流程	暂停呼叫流程	恢复呼叫流程
摘机=0,0							
呼出=10,1							
	呼入=20,1	取消呼出=100,12					
	接受呼入=30,1		拒接呼入=100,14	转移呼入=100,13			
呼出被接受=40,1							
连接媒体流=50,1	连接媒体流=50,1						
					转移呼入=+10,13	暂停呼叫=+1,2	
							恢复呼叫=+1,3
断开媒体流=90,1	断开媒体流=90,1				断开媒体流=90,1		
结束呼出=100,10	结束呼入=100,10				呼叫呼入=100,13		
注：
● 转移流程：在不同的阶段进行转移,其进度值不一样.
● 暂停流程：在不同的阶段进行取消,其进度值不一样.
初始化完成（2000）
设备通讯库初始化完毕后，触发此事件。
应用范围：所有设备

● 事件编码：2000	
● 事件消息：（参见基本消息）
摘机（2001）
设备准备发起呼叫前，触发此事件。
● 对主机而言，即要摘机时触发此事件，且一般应该在此时 播放拔号音
● 对分机而言，由于没有摘机动作，故无需触发此事件
适用范围：主叫方
● 事件编码：2001
● 事件消息：
{
    // 头部参见基本消息
    "payload": {
        // 其它负载参见基本消息
        "from": 本机号码
    }
}
呼出（2002）
设备拔号后并发起呼叫时，触发此事件。
对通讯事件而言，就是在发起 SIP 呼叫时触发此事件。
每次发起呼叫，即启动一个事务。
此时设备应用 snowflake 算法自动生成一个 tid 值，
并且在此通话过程的每个环节均附上此 tid 值，
于是服务器或其它设备就可以据此来跟踪该通话。
事务 ID 生成详见：设备事务处理 - 事务 ID
适用范围：主叫方
● 事件编码：2002
● 事件消息：
{
    // 头部参见基本消息
    "payload": {
        // 其它负载参见基本消息
        "from": 本机号码,
        "to"  : 被叫号码,
        "progress": 10,  // 进度值参考
        "result"  : 1    // 结果值参考（事务正处理）
    }
}
取消呼出（2003）
设备主动取消呼出时，触发此事件。
适用范围：主叫方
● 事件编码：2003
● 事件消息：
{
    // 头部参见基本消息
    "payload": {
        // 其它负载参见基本消息
        "from": 本机号码,
        "to"  : 被叫号码,
        "progress": 10,  // 进度值参考
        "result"  : 12   // 结果值参考（事务被忽略）
    }
}
呼出被接通（2004）
设备呼出被接通时，触发此事件。
适用范围：主叫方
● 事件编码：2004
● 事件消息：
{
    // 头部参见基本消息
    "payload": {
        // 其它负载参见基本消息
        "from": 本机号码,
        "to"  : 被叫号码,
        "progress": 40,  // 进度值参考
        "result"  : 1    // 结果值参考（事务正处理）
    }
}
呼出结束（2005）
设备呼叫结束后，触发此事件。
呼叫结束包括：正常挂断、出错、超时等任何结束情况。
适用范围：主叫方
● 事件编码：2005
● 事件消息：
{
    // 头部参见基本消息
    "payload": {
        // 其它负载参见基本消息
        "from": 本机号码,
        "to"  : 被叫号码,
        "progress": 100,  // 进度值参考
          "result"  : 10    // 结果值参考（事务已完成）；如果是出错，则为 19
    }
}
呼入（2100）
接被叫方接收到呼叫后，在接听前，触发此事件。
适用范围：被叫方
● 事件编码：2100
● 事件消息：
{
    // 头部参见基本消息
    "payload": {
        // 其它负载参见基本消息
        "from": 本机号码,
        "to"  : 被叫号码,
        "progress": 20,  // 进度值参考
        "result"  : 1    // 结果值参考（事务进行中）
    }
}
拒接呼入（2101）
被叫方拒接呼入时，触发此事件。	
适用范围：被叫方
● 事件编码：2101
● 事件消息：
{
    // 头部参见基本消息
    "payload": {
        // 其它负载参见基本消息
        "from": 本机号码,
        "to"  : 被叫号码,
        "message" : "拒接原因",
        "progress": 30,  // 进度值参考
        "result"  : 14   // 结果值参考（事务被拒绝）
    }
}
接受呼入（2102）
接被叫方按下接听后，触发此事件。
适用范围：被叫方
● 事件编码：2102
● 事件消息：
{
    // 头部参见基本消息
    "payload": {
        // 其它负载参见基本消息
        "from": 本机号码,
        "to"  : 被叫号码,
        "progress": 30,  // 进度值参考
        "result"  : 1    // 结果值参考（事务进行中）
    }
}
结束呼入（2103）
被叫方结束呼入后，触发此事件。
呼叫结束包括：正常挂断、出错、超时等任何结束情况。
适用范围：被叫方
● 事件编码：2103
● 事件消息：
{
    // 头部参见基本消息
    "payload": {
        // 其它负载参见基本消息
        "from": 本机号码,
        "to"  : 被叫号码,
        "progress": 100,  // 进度值参考
        "result"  : 10    // 结果值参考（事务已完成）；如果是超时未接听，则为 15 ；如果是出错，则为 19 。
    }
}
转移呼叫（2104）
被叫方转移呼叫时，触发此事件。
适用范围：被叫方
● 事件编码：2104
● 事件消息：
{
    // 头部参见基本消息
    "payload": {
        // 其它负载参见基本消息
        "from": 本机号码,
        "to"  : 被叫号码,
        "transfer": 转移号码,
        "progress": 100,  // 进度值参考
        "result"  : 13    // 结果值参考（事务被转移）
    }
}
呼叫等待（2105）
被叫方无法马上接听，但不想拒接，则可以选择呼叫等待，此时应触发呼叫等待事件。
等待期间应定时执行主叫方的 callkeep 动作。
适用范围：被叫方
● 事件编码：2105
● 事件消息：
{
    // 头部参见基本消息
    "payload": {
        // 其它负载参见基本消息
        "from": 本机号码,
        "to"  : 被叫号码,
        "progress": 最近进度+1,  // 进度值参考
        "result"  : 1          // 结果值参考（事务进行中）
    }
}
连接媒体流（2200）
接被叫方接通呼叫后，触发此事件。
适用范围：被叫方
● 事件编码：2200
● 事件消息：
{
    // 头部参见基本消息
    "payload": {
        // 其它负载参见基本消息
        "from": 本机号码,
        "to"  : 被叫号码,
        "progress": 50,  // 进度值参考
        "result"  : 1    // 结果值参考（事务进行中）
    }
}
断开媒体流（2201）
设备断开媒体流后，时触发此事件。
适用范围：主叫方 和 被叫方
● 事件编码：2201
● 事件消息：
{
    // 头部参见基本消息
    "payload": {
        // 其它负载参见基本消息
        "from": 本机号码,
        "to"  : 被叫号码,
        "progress": 90,  // 进度值参考
        "result"  : 1    // 结果值参考（事务进行中）
    }
}
暂停呼叫（2300）
当呼叫参与的任一方需要暂时挂起当前呼叫时触发此事件。
暂停意思是其中一方想暂时中止通话，但不挂断通话，可以在后续操作中随时恢复通话。
注意：在双方通话中，如果暂停方应在暂停通话后向向对方定时发送通话保持消息，即执行对方的 callkeep 动作，目的是告知对方，自己还在通话中，否则对方可能会长时间无声音而挂断。
对主叫方而言，在呼叫通话过程中，如何有呼入，则可以选择中止现有呼叫，也可选择暂停现有呼叫。
适用范围：主叫方 和 被叫方
● 事件编码：2300
● 事件消息：
{
    // 头部参见基本消息
    "payload": {
        // 其它负载参见基本消息
        "from": 本机号码,
        "to"  : 被叫号码,
        "progress": 60,  // 进度值参考
        "result"  : 2    // 结果值参考（事务被挂起）
    }
}
恢复呼叫（2301）
任意一方从呼叫暂停中恢复时，触发此事件。
适用范围：主叫方 和 被叫方
● 事件编码：2301
● 事件消息：
{
    // 头部参见基本消息
    "payload": {
        // 其它负载参见基本消息
        "from": 本机号码,
        "to"  : 被叫号码,
        "progress": 65,  // 进度值参考
        "result"  : 3,    // 结果值参考（事务被恢复）
        // 事务恢复后，如果没有别的事要做，
        // 应接着发布事务进行中的进度事件，
        // 否则等这些事做完后再发布：
        // "result"  : 1  // 事务进行中
    }
}
资源事件（3xxx）
平台服务器资源发生变更时，由平台服务器发出的事件。
当资源发生变化时，比如数据库某个数据表中的某条记录被修改，或者传感器采集到了新的数据，
则相应作出数据库记录修改的模块或服务，或者采集到新数据的传感器就要发出“资源变更事件”，
从而订阅了该事件的设备或应用就可以相应地变更本地与之对应的数据（可从事件消息体或远端拉取）。
例如：
某服务器的数据库中，病人个人数据表中存储病人个人数据库，则该病人个人数据表为一种资源集合。
当病人个人数据表中，某个病人 id 对应的病人数据被变更，则服务器应发出 “病人个人数据变更事件”，
从而订阅了该事件的设备或应用就可以相应地变更本地的病人个人数据（可从事件消息体或远端拉取）。
资源变更事件主题格式如下：
其中：
资源集合列表见资源集合列表
主题和应用示例可参考
 附录A：资源变更事件主题示例
● 附录B：资源变更事件应用示例
● 父资源更新：/voerka/<domain>/rs/<资源集合名称>/<资源id>
这样订阅 /voerka/<domain>/rs/<资源集合名称>/<资源id>/# 则可以收到其所有此资源的变更
例如订阅 /voerka/<domain>/rs/<病人资源集合名称>/<病人id>/# 就可以收到该病人的住院记录、用药记录、医嘱、费用等变更
约定：<资源id>=__ALL__ 代表资源集合整体。
这样订阅 /voerka/<domain>/rs/<资源集合名称>/__ALL__/# 则可以收到其所有此资源集合的整体变更
例如订阅 /voerka/<domain>/rs/<病人资源集合名称>/__ALL__/# 就可以收到病人集合的整体变更（例如所有病人的入住天数、年龄的整体变更）
● 子资源更新：/voerka/<domain>/rs/<资源集合名称>/<资源id>/<资源子集合名称>/<子资源id>
例如医嘱的变更事件会发往 /voerka/<domain>/rs/<病人资源集合名称>/<病人id>/<医嘱资源集合名称>/<医嘱id>
● 树资源更新：/voerka/<domain>/rs/<资源集合名称>/<变更资源路径>
例如导航节点的变更事件会发往 /voerka/<domain>/rs/<导航节点资源集合名称>/<变更节点路径>
如：/voerka/hispro/rs/navigatornodes/default/海南12095医院/心血管内科1/东七病区/东七1号房/东七12号床
树资源是指组织成树形式的资源，如组成的导航树的“导航节点”资源。
当一个资源的组织形式是树，那么它更新的时候：除了发布父资源或子资源更新事件，还会发布树资源更新，供客户端按路径的需要订阅
创建资源（3001）
注：关于下述内容中的 url
● 如果以 / 开头，则为相对路径，相对于已知的 web 服务地址和端口，否则为绝对路径
● 如果为空，则自主拼接，格式为：/apps/hispro/api/<消息主题去掉/voerka/<domain>/rs/>
所有资源变更事件都同
● 事件编码：3001
● 事件消息：
{
    ...头略
    "payload": {
        "code": 3001,
        "url": "获取该资源的url（见上注）",
        "resType": "资源类型名称",
        "resId": "资源id",
        "params": {/*资源变更参数*/},
        "fields": [/*空*/],
        "modifiedData": {/*被创建的资源数据（可选）*/},
    }
}
更新资源（3002）
● 事件编码：3002
● 事件消息：
{
    ...头略
    "payload": {
        "code": 3002,
        "url": "获取该资源的url（见上注）",
        "resType": "资源类型名称",
        "resId": "资源id",
        "params": {/*资源变更参数*/},
        "fields": [/*更新的字段（可选）*/],  // [] 则所有
        "modifiedData": {/*更新后的资源数据（可选）*/},
    }
}
删除资源（3003）
● 事件编码：3003
● 事件消息：
{
    ...头略
    "payload": {
        "code": 3003,
        "url": "获取该资源的url（见上注）",
        "resType": "资源类型名称",
        "resId": "资源id",
        "params": {/*资源变更参数*/},
        "fields": [/*空*/],
        "modifiedData": {/*删除后的资源数据*/},
    }
}
压入资源（3004）
队列型资源数据压入事件
● 事件编码：3004
● 事件消息：
{
    ...头略
    "payload": {
        // 双字节无符号整型
        "code": 3004,
        // 变长字符串（长度<2^8字节）  
        // 加参数 pop=true 则弹出
        "url": "/apps/hispro/api/<主题路径末端集合名称>/<主题路径末端id>[?pop=true]",
        // 双字节无符号整型
        "index": 压入位置,
        // 双字节无符号整型
        "length": 队列长度
    }
}
弹出资源（3005）
队列型资源数据弹出事件
● 事件编码：3005
● 事件消息：
{
    ...头略
    "payload": {
        // 双字节无符号整型
        "code": 3005,
        // 双字节无符号整型
        "index": 弹出位置,
        // 双字节无符号整型
        "length": 队列长度
    }
}
变更资源（3006）
队列型资源数据更新事件
注：不包括位置的更新，位置更新另有事件
● 事件编码：3006
● 事件消息：
{
    ...头略
    "payload": {
        // 双字节无符号整型
        "code": 3006,
        // 变长数组（长度<2^8个），数组元素为变长字符串（长度<2^8字节）
        "fields": [...更新了哪些字段]  // [] 则所有
        // 双字节无符号整型
        "index": 更新位置,
        // 双字节无符号整型
        "length": 队列长度
    }
}
单调资源（3007）
队列型资源数据单调事件（单个调动顺序）
注：对调事件主题的 路径末端id 为 __jump__
● 事件编码：3007
● 事件消息：
{
    ...头略
    "payload": {
        // 双字节无符号整型
        "code": 3007,
        // 变长字符串（长度<2^8字节）
        "id": "资源id",
        // 定长数组，数组元素为双字节无符号整型
        "index": [调动前位置, 调动后位置],
        "length": 队列长度
    }
}
对调资源（3008）
队列型资源数据对调事件（成对调换顺序）
注：对调事件主题的 路径末端id 为 __switch__
● 事件编码：3008
● 事件消息：
{
    ...头略
    "payload": {
        // 双字节无符号整型
        "code": 3008,
        // 变长字符串（长度<2^8字节）
        "id": [一个资源id，另一个资源id],  // 与 index 对应
        // 定长数组，数组元素为双字节无符号整型
        "index": [一个位置, 另一个位置],
        // 双字节无符号整型
        "length": 队列长度
    }
}
I/O事件（4xxx）
指由 I/O 触发的事件，如按键、短路输入等等。
会议事件（5xxx）
指设备参与FS会议生命周期内产生的各种事件。事件的触发是通过广播频道进行的。
每个会议号码对应一个广播频道，如会议号码3001，则对应广播频道：
/voerka/{domain}/broadcast/3001
当会议参与方要触发事件时，就向该主题发送事件。
准备进入会议（5000）
准备进入会议前，即开始呼叫会议号码前。
已进入会议（5001）
呼叫会议号码并接通后，触发此事件。
退出会议（5002）
准备退出时触发些事件。
参与会议异常（5003）
会议参与方由于各种原因出错无法拔通会议号码时。
用户事件（6xxx）
当设备绑定用户帐号时，产生的与用户相关的事件。
发布主题为 /voerka/<domain>/users/<username>/events/可选事件名称
如：/voerka/hispro/users/admin/events/login
用户登录（6000）
● 事件编码：6000
● 事件名称：login
● 事件消息：

{
    ...头略
    "payload": {
        "code": 6000,
        "type": "用户类型，如 doctor",
        // 其它待定
    }
}
用户登出（6001）
● 事件编码：6001
● 事件名称：logout
● 事件消息：
{
    ...头略
    "payload": {
        "code": 6001,
        "type": "用户类型，如 doctor",
        // 其它待定
    }
}
？？事件（7xxx）
保留。
应用业务事件（8xxx）
应用业务事件。
注：以下负载只列出除了 code 和 message 以及可选的进度信息之外的字段
编码	级别	说明	负载
8011	×	防水分机告警结束
（用于结束旧编码8001告警）
（注<下同>：之前的编码方式是一种告警有两个专用编码，即一个是此种告警开始专用的告警编码，另一个是此种告警结束专用的事件编码。
后来为了减少编码占用，改用另一种编码方式，即一种告警只有一个专用编码，一个是此种告警开始专用的告警编码，另一个是通用的告警已取消或已处置事件编码<1005/1006>，并在事件负载中 alarmCode 指示结束的是哪种告警对应的编码。
但这种减少编码占用的编码方式只能是建议而无法强制，因此实际进行编码可能还是会回到原有的编码方式，例如吸氧告警采用的就是原来的编码方式，它的告警开始专用告警编码是800011，它的告警结束专用事件编码是800025。
另外，采用第二种编码方式的同时，保留原有的告警专用编码，并对这些原有的告警进行重新编码，因此就有了 8001/80001 等编码的同时存在。）	
8012	×	输液告警结束
（用于结束旧编码8002告警）	
8013	×	换药提醒告警结束
（用于结束旧编码8003告警）	
8014	×	离床告警结束
（用于结束旧编码8004告警）	
8015	×	请求增援结束
（用于结束旧编码8005告警）	
80006	3	巡视提醒	
80007	3	吸氧开始	
80008	3	吸氧暂停	
80009	3	吸氧继续	
80010	3	吸氧复位	
80011	3	体动提醒	
80012	3	返院提醒	
80013	3	返区提醒	
80014	3	返房提醒	
80015	3	返床提醒	
80016	3	输液开始	
80017	3	输液进行中	
80018	3	输液即将完成	
80019	3	输液结束	
80020	3	有人提醒	
80021	3	无人提醒	
设备特有事件（9xxx）
设备特有事件。
附录A：资源变更事件主题示例
节点：
/voerka/hispro/rs/navigators/default/nodes/节点id
/voerka/hispro/rs/navigators/default/nodes/节点路径
/voerka/hispro/rs/navigatornodes/节点id
/voerka/hispro/rs/navigatornodes/节点路径
病区：
/voerka/hispro/rs/areas/病区id
/voerka/hispro/rs/areas/绑定路径
可能造成节点变更，触发节点变更事件（见上）
病房：
/voerka/hispro/rs/rooms/病房id
/voerka/hispro/rs/rooms/绑定路径
可能造成节点变更，触发节点变更事件（见上）
病床：
/voerka/hispro/rs/beds/病床id
/voerka/hispro/rs/beds/绑定路径
可能造成节点变更，触发节点变更事件（见上）
病人：（包括入院、出院、转床）
/voerka/hispro/rs/patients/病人name
/voerka/hispro/rs/patients/绑定路径
可能造成节点变更，触发节点变更事件（见上）
医生：
/voerka/hispro/rs/doctors/医生name
/voerka/hispro/rs/doctors/绑定路径
可能造成节点变更，触发节点变更事件（见上）
护士：
/voerka/hispro/rs/nurses/护士name
/voerka/hispro/rs/nurses/绑定路径
可能造成节点变更，触发节点变更事件（见上）
病人医嘱：
/voerka/hispro/rs/medicalAdvices/病人医嘱id
/voerka/hispro/rs/patients/病人id/medicalAdvices/id
用药记录：
/voerka/hispro/rs/medicalRecords/用药记录id
/voerka/hispro/rs/patients/病人id/medicalRecords/id
费用清单：
/voerka/hispro/rs/medicalExpenses/费用清单id
/voerka/hispro/rs/patients/病人id/medicalExpenses/id
通讯录：
/voerka/hispro/rs/contacts/通讯录id（当前约定id=default）
字典：
/voerka/hispro/rs/dicts/字典id（当前约定id=default）
附录B：资源变更事件应用示例
1. 病人信息实时更新
病人信息包括：
● 个人数据
● 预约记录
● 住院记录
● 用药记录
● 医嘱内容
● 缴费记录
● 扣费记录
当某个病人信息发生变化，比如管理端向 web 服务提交修改病人的病情、医嘱和用药记录，
web 服务收到并处理，在处理完毕，即更新了相关数据库后，则向如下主题发送如下内容：
1.1. 病人个人数据更新
主题：/voerka/<domain>/rs/patients/此病人id
内容：
{
    ...头略
    "payload": {
        "id": "此病人id",
        "url": "/apps/hispro/api/patients/此病人id",
        "fields": ["condition"],
        "device": "相关设备序列号"  // 不一定有值，视约定，无则 ""
    }
}
1.2. 病人医嘱内容更新
主题：/voerka/<domain>/rs/patients/此病人id/medicalAdvices/此医嘱id
内容：
{
    ...头略
    "payload": {
        "id": "此医嘱id",
        "url": "/apps/hispro/api/patients/此病人id/medicalAdvices/此医嘱id",
        "fields": ["content", "signature"],  // 假设更新了内容和签名
        "device": "相关设备序列号"  // 不一定有值，视约定，无则 ""
    }
}
1.3. 病人用药记录更新
主题：/voerka/<domain>/rs/patients/此病人id/medicineRecords/此用药记录id
内容：
{
    ...头略
    "payload": {
        "id": "此用药记录id",
        "url": "/apps/hispro/api/patients/此病人id/medicineRecords/此用药记录id",
        "fields": [],
        "device": "相关设备序列号"  // 不一定有值，视约定，无则 ""
    }
}
设备端若事先订阅了该主题，则会收到此消息，从而相应拉取并更新病人病情、医嘱内容和用药记录。
2. 分机获知其病人id
在病人信息实时更新的示例中，假设了设备已经订阅了 /voerka/<domain>/rs/patients/此病人id
但是设备如何知道自己要订阅哪个病人的数据更新
又或者设备订阅 /voerka/<domain>/rs/patients/#，设备如何知道哪个病人数据更新是自己要处理的
总之设备要先获知其关联病人 id
方法是：
1. 管理端先将设备绑定到导航节点上，服务端更新数据库导航树，在更新设备 group 属性
2. 分机订阅导航类型资源的更新：/voerka/<domain>/rs/navigators/<设备group根，也就是导航id>
3. 管理端再将病人绑定到导航节点上，作为该节点的关联资源，服务端更新数据库导航树后，
应向如下主题发送如下消息：
主题：/voerka/<domain>/rs/navigators/<该导航id> （插值皆可知）
消息：
{
    ...头略
    "payload": {
        "url": "/apps/hispro/api/navigators/此导航id?nodeId=节点id",  // 则只会获取到该节点数据
        "fields": ["related"]  // 表示修改了 related 字段,
        "device": "该设备序列号"
    }
}
4. 设备收到该消息，拉取节点数据，节点数据存在 related 字段为数组，
从 related 数组中找到 type=patient 的关联资源，取其 id 则可获知 病人id
已定义的关联资源见关联资源
版本历史
版本	作者	发布时间	批准	备注
v1.0.0	LTH	2019.07.09	-	-
v1.0.1	LTH	2019.07.15	ZWX	按张工意见修改资源变更事件
v1.0.2	LTH	2019.10.09	-	整理
v1.0.3	LTH	2020.05.12	-	整理
v1.0.4	LTH	2020.05.15	ZWX	按张工意见增设统一的告警取消事件和告警已处理事件
v1.0.4	LTH	2020.06.29	ZWX	补充告警取消
和处理
事件内容：
　　- 增加一个 userId
 以便获知结束告警的用户
　　- 增加一个 remarks
 以便在结束告警是附带一些备注信息
　　- 增加一个 alarmResult
 用于表示告警处理结果
v1.0.5	LTH	2020.07.27	ZWX	增设设备性能报告事件
事件
v1.0.6	LTH	2020.11.16	-	增设设备主电源已恢复事件
事件
v1.0.7	LTH	2022.01.06	-	增设关于资源集合整体变更的事件订阅主题的约定
v1.0.8	LTH	2022.08.17	-	增设常用业务事件编码。详见
v1.0.9	LTH	2023.04.21	-	增设吸氧业务事件（80007~80010）。
v1.0.10	LTH	2023.06.24	-	增设体动提醒事件（80011）。